<mujoco model="xarm7_tray">
	<!--? Basic compiler and simulation options -->
	<compiler angle="radian"  inertiafromgeom="true" meshdir="./assets"
		texturedir="./assets" autolimits="true" />
	<option gravity="0 0 -9.81" integrator="implicitfast" noslip_iterations="100" />
	<size njmax="200" nconmax="200" /> <!--
	? do not know what this does-->

	<!--?Defaults for geoms and joints -->
	<!--?=================================================================================================================================================================================== -->
	<!--?=================================================================================================================================================================================== -->
	<!--?=================================================================================================================================================================================== -->

	<default>
		<default class="xarm7">
			<geom type="mesh" material="white" />
			<joint axis="0 0 1" armature="0.1" range="-6.28319 6.28319" frictionloss="1" />
			<general biastype="affine" ctrlrange="-6.28319 6.28319" />
			<default class="size1">
				<joint damping="10" />
				<general gainprm="1500" biasprm="0 -1500 -150" forcerange="-50 50" />
			</default>
			<default class="size2">
				<joint damping="5" />
				<general gainprm="1000" biasprm="0 -1000 -100" forcerange="-30 30" />
			</default>
			<default class="size3">
				<joint damping="2" />
				<general gainprm="800" biasprm="0 -800 -80" forcerange="-20 20" />
			</default>
			<default class="spring_link">
				<joint range="0 0.85" stiffness="0.05" springref="2.62" damping="0.00125" />
			</default>
			<default class="driver">
				<joint range="0 0.85" armature="0.005" damping="0.1" solreflimit="0.005 1" />
			</default>
			<default class="follower">
				<joint range="0 0.85" solreflimit="0.005 1" />
			</default>
			<default class="visual">
				<geom type="mesh" contype="0" conaffinity="0" group="2" />
			</default>
			<default class="collision">
				<geom type="mesh" group="3" />
				<default class="pad_box1">
					<geom type="box" friction="0.7" solimp="0.95 0.99 0.001" solref="0.004 1"
						mass="0" priority="1" size="0.015 0.002 0.0095" rgba="0.0 0.1 0.7 1" />
				</default>
				<default class="pad_box2">
					<geom type="box" friction="0.6" solimp="0.95 0.99 0.001" solref="0.004 1"
						mass="0" priority="1" size="0.015 0.002 0.0095" rgba="0.0 0.5 0.5 1" />
				</default>
			</default>
			<site size="0.001" rgba="1 0 0 1" group="4" />
		</default>
	</default>


	<asset>
		<material name="white" rgba="1 1 1 1" />
		<material name="gray" rgba="0.753 0.753 0.753 1" />
		<material name="black" rgba="0.149 0.149 0.149 1" />

		<mesh file="link_base.stl" />
		<mesh file="link1.stl" />
		<mesh file="link2.stl" />
		<mesh file="link3.stl" />
		<mesh file="link4.stl" />
		<mesh file="link5.stl" />
		<mesh file="link6.stl" />
		<mesh file="link7.stl" />
		<mesh file="end_tool.stl" />
		<mesh file="base_link.stl" />
		<mesh file="left_outer_knuckle.stl" />
		<mesh file="left_finger.stl" />
		<mesh file="left_inner_knuckle.stl" />
		<mesh file="right_outer_knuckle.stl" />
		<mesh file="right_finger.stl" />
		<mesh file="right_inner_knuckle.stl" />
	</asset>

	<default>
		<geom rgba="0.7 0.7 0.7 1" solref="0.002 1" friction="0.1 0.1 0.001"
			solimp="0.9 0.95 0.001" contype="1" conaffinity="1" />                         <!--! !!!!!!!!!!!!! UPDATE FRICTION HERE !!!!!!!!!!!!!!!!!!-->
		<joint type="free" damping="0" limited="false" />
	</default>

	<asset>
		<texture type="skybox" builtin="gradient" rgb1="0.3 0.5 0.7" rgb2="0 0 0" width="512"
			height="3072" />
		<texture type="2d" name="groundplane" builtin="checker" mark="edge" rgb1="0.2 0.3 0.4"
			rgb2="0.1 0.2 0.3"
			markrgb="0.8 0.8 0.8" width="300" height="300" />
		<material name="groundplane" texture="groundplane" texuniform="true" texrepeat="5 5"
			reflectance="0.2" specular="0.2" shininess="0.1" />
	</asset>

	<visual>
		<headlight diffuse="0.6 0.6 0.6" ambient="0.6 0.6 0.6" specular="0 0 0.6" />
		<rgba haze="0.15 0.25 0.35 1" />
		<global azimuth="120" elevation="-20" />
	</visual>

	<asset>
		<material name="mat_tray" rgba="0.55 0.55 0.6 1" reflectance="0.0" specular="0.4"
			shininess="0.6" />
		<material name="mat_cube" rgba="0.0 0.9 0.2 1" reflectance="0.0" specular="0.5"
			shininess="0.7" />
	</asset>

	<!--?	=================================================================================================================================================================================== -->
	<!--?	=================================================================================================================================================================================== -->
	<!--?	=================================================================================================================================================================================== -->


	<worldbody>
		<!--? Lighting and ground plane -->`
		<light pos="0 0 1.5" dir="0 0 -1" directional="true" />
		<geom name="floor" type="plane" size="5 5 0.1" material="groundplane" contype="1"
			conaffinity="1" />

		<body name="L_world_virtual_link" pos="-0.7 0 -0.12" quat="0.707 0 0 -0.707">
			<include file="./chainL.xml" />
		</body>

		<body name="R_world_virtual_link" pos="0.7 0 -0.12" quat="0.707 0 0 -0.707">
			<include file="./chainR.xml" />
		</body>

		<!-- ? Free-moving tray body -->
		<body name="tray" pos="0 0 0.4">
			<freejoint name="tray_free" />
			<geom name="tray_bottom" type="box" size="0.2 0.15 0.005" pos="0 0 0"
				material="mat_tray" mass = "1" />
		</body>

		<!--?Mocap body -->
		<body name="mocap_marker" mocap="true" pos="0 0 0.3">
			<geom type="sphere" size="0.01" rgba="1 0 0 0.6" contype="0" conaffinity="0" />
		</body>

		<body name="R_mocap_marker" mocap="true" pos="0.2 0 0.4" quat="0.5 -0.5 -0.5 0.5">
			<geom type="box" size="0.05 0.05 0.05" rgba="1 0 0 0" contype="0" conaffinity="0" />
			<site name="Rtarg" />
		</body>

		<body name="L_mocap_marker" mocap="true" pos="-0.2 0 0.4" quat="0.5 0.5 0.5 0.5">
			<geom type="box" size="0.05 0.05 0.05" rgba="1 0 0 0" contype="0" conaffinity="0" />
			<site name="Ltarg" />
		</body>

		<body name="cube2" pos="0.0 .0 0.33">
			<freejoint name="cube_free" /><!--! !!!!!!!!!!!!! LOW FRICTION HERE !!!!!!!!!!!!!!!!!!-->
			<!-- <geom name="cube_geom" type="box" size="0.025 0.025 0.025" material="mat_cube" friction="0.05 0.05 0.0005" density="10" rgba="0.0 0.9 0.2 1" conaffinity="0" />  -->
			<geom name="cube_geom" type="cylinder" size="0.025 0.025" material="mat_cube" friction="0.05 0.05 0.0005" mass="2" rgba="0.0 0.9 0.2 1" conaffinity="0" /> 
			<!-- <geom name="cube_geom" type="sphere" size="0.025" material="mat_cube" friction="0.05 0.05 0.0005" density="10" rgba="0.0 0.9 0.2 1" conaffinity="0" />  -->
			<!--! !!!!!!!!!!!!! LOW FRICTION HERE !!!!!!!!!!!!!!!!!!-->
			<!-- <geom name="cube_geom" type="box" size="0.025 0.025 0.025" material="mat_cube" friction="0.1 0.1 0.001" density="10" rgba="0.0 0.9 0.2 1" conaffinity="0" />  -->
			<!-- <geom name="cube_geom" type="cylinder" size="0.022 0.022" material="mat_cube" friction="0.1 0.1 0.001" density="10" rgba="0.0 0.9 0.2 1" conaffinity="0" />  -->
			<!-- <geom name="cube_geom" type="sphere" size="0.022" material="mat_cube" friction="0.1 0.1 0.001" density="10" rgba="0.0 0.9 0.2 1" conaffinity="0" />  -->
			<!--! !!!!!!!!!!!!! HIGH FRICTION HERE !!!!!!!!!!!!!!!!!!-->
			<!-- <geom name="cube_geom" type="box" size="0.022 0.022 0.022" material="mat_cube" friction="0.2 0.2 0.001" density="10" rgba="0.0 0.9 0.2 1" conaffinity="0" />  -->
			<!-- <geom name="cube_geom" type="cylinder" size="0.022 0.022" material="mat_cube" friction="0.2 0.2 0.002" density="10" rgba="0.0 0.9 0.2 1" conaffinity="0" />  -->
			<!-- <geom name="cube_geom" type="sphere" size="0.022" material="mat_cube" friction="0.2 0.2 0.002" density="10" rgba="0.0 0.9 0.2 1" conaffinity="0" />  -->

		</body>

		<body name="targ" pos="0.0 0.0 0.43" mocap="true">
			<geom name="targ_geom" type="sphere" size="0.02"
				density="10" rgba="0.9 0.0 0.2 1" conaffinity="0" contype="0"/>
		</body>

	</worldbody>

	<keyframe>
		<key name="home" qpos="2 -0.15 -0.38 0.49 0.11 -0.93 1.4 0.8 0.8 0.8 0.8 0.8 0.8 -1.1 -0.12 -0.47 0.5 -0.018 -0.97 -1.6 0.8 0.8 0.8 0.8 0.8 0.8 2.3e-16 -4.5e-16 0.4 1 3.3e-18 -7e-20 -9.2e-16 -1e-16 -5.7e-16 0.427 0.707 0.707 0 0" />
		<!-- <key name="home" qpos="2 -0.15 -0.38 0.49 0.11 -0.93 1.4 0.8 0.8 0.8 0.8 0.8 0.8 -1.1 -0.12 -0.47 0.5 -0.018 -0.97 -1.6 0.8 0.8 0.8 0.8 0.8 0.8 2.3e-16 -4.5e-16 0.4 1 3.3e-18 -7e-20 -9.2e-16 -1e-16 -5.7e-16 0.43 1 -1.3e-17 -3.3e-18 2.8e-15" /> -->
	</keyframe>

	<contact>
		<exclude body1="L_right_inner_knuckle" body2="L_right_outer_knuckle" />
		<exclude body1="L_right_inner_knuckle" body2="L_right_finger" />
		<exclude body1="L_left_inner_knuckle" body2="L_left_outer_knuckle" />
		<exclude body1="L_left_inner_knuckle" body2="L_left_finger" />
		<exclude body1="R_right_inner_knuckle" body2="R_right_outer_knuckle" />
		<exclude body1="R_right_inner_knuckle" body2="R_right_finger" />
		<exclude body1="R_left_inner_knuckle" body2="R_left_outer_knuckle" />
		<exclude body1="R_left_inner_knuckle" body2="R_left_finger" />
	</contact>

	<tendon>
		<fixed name="L_split">
			<joint joint="L_right_driver_joint" coef="0.5" />
			<joint joint="L_left_driver_joint" coef="0.5" />
		</fixed>
		<fixed name="R_split">
			<joint joint="R_right_driver_joint" coef="0.5" />
			<joint joint="R_left_driver_joint" coef="0.5" />
		</fixed>
	</tendon>

	<equality>
		<connect anchor="0 0.015 0.015" body1="R_right_finger" body2="R_right_inner_knuckle" solref="0.005 1"/>
		<connect anchor="0 -0.015 0.015" body1="R_left_finger" body2="R_left_inner_knuckle" solref="0.005 1"/>
    	<joint joint1="R_left_driver_joint" joint2="R_right_driver_joint" polycoef="0 1 0 0 0" solref="0.005 1"/>

		<connect anchor="0 0.015 0.015" body1="L_right_finger" body2="L_right_inner_knuckle" solref="0.005 1"/>
		<connect anchor="0 -0.015 0.015" body1="L_left_finger" body2="L_left_inner_knuckle" solref="0.005 1"/>
    	<joint joint1="L_left_driver_joint" joint2="L_right_driver_joint" polycoef="0 1 0 0 0" solref="0.005 1"/>
  </equality>

	<actuator>
		<motor name="L_act1" joint="L_joint1" ctrlrange="-50 50" />
		<motor name="L_act2" joint="L_joint2" ctrlrange="-50 50" />
		<motor name="L_act3" joint="L_joint3" ctrlrange="-30 30" />
		<motor name="L_act4" joint="L_joint4" ctrlrange="-30 30" />
		<motor name="L_act5" joint="L_joint5" ctrlrange="-20 20" />
		<motor name="L_act6" joint="L_joint6" ctrlrange="-20 20" />
		<motor name="L_act7" joint="L_joint7" ctrlrange="-20 20" />

		<motor name="R_act1" joint="R_joint1" ctrlrange="-50 50" />
		<motor name="R_act2" joint="R_joint2" ctrlrange="-50 50" />
		<motor name="R_act3" joint="R_joint3" ctrlrange="-30 30" />
		<motor name="R_act4" joint="R_joint4" ctrlrange="-30 30" />
		<motor name="R_act5" joint="R_joint5" ctrlrange="-20 20" />
		<motor name="R_act6" joint="R_joint6" ctrlrange="-20 20" />
		<motor name="R_act7" joint="R_joint7" ctrlrange="-20 20" />

		<general name="L_gripper" tendon="L_split" forcerange="-50 50" ctrlrange="0 255"
			biastype="affine" gainprm="0.333"
			biasprm="0 -100 -10" />
		<general name="R_gripper" tendon="R_split" forcerange="-50 50" ctrlrange="0 255"
			biastype="affine" gainprm="0.333"
			biasprm="0 -100 -10" />

	</actuator>


</mujoco>
